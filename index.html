<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Exercise</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <style>
    #mapid { width: 600px; height: 400px; }
    #controls { margin: 15px; }
  </style>
</head>
<body>
  <div id="mapid"></div>
  <div id="controls">
    <button id="showAllTreesButton">Show All Trees</button>
    <span style="display:inline-block; width: 30px"></span>
    <input type="text" id="highlightTreesTextEntry" placeholder="tree taxa" />
    <button id="highlightTreesButton">Highlight</button>
    <button id="resetHighlightButton">Reset</button>
  </div>

  <script>
    var map = L.map('mapid', {
      center: [49.265637, -123.256113],
      zoom: 15
    });

    L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      maxZoom: 17,
      attribution: 'Basemap data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var treeMarkerOptions = {
      radius: 4,
      fillColor: "#007800",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 0.8
    };

    var treeMarkerHighlightedOptions = {
      radius: 6,
      fillColor: "#FF9900",
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 0.8
    };

    function onEachTree(feature, layer) {
      if (feature.properties && feature.properties.TAXA) {
        layer.bindTooltip(feature.properties.TAXA);
      }
    }

    function treePointToLayer(feature, latlng) {
      return L.circleMarker(latlng, treeMarkerOptions);
    }

    var lastLayerAdded;
    var treeGeoJSONdata;

    function addTrees() {
      if(lastLayerAdded) {
        map.removeLayer(lastLayerAdded);
      }
      lastLayerAdded = L.geoJSON(treeGeoJSONdata, {
        pointToLayer: treePointToLayer,
        onEachFeature: onEachTree
      }).addTo(map);
    }

    function highlightTrees(taxaToHighlight) {
      var filteredData = treeGeoJSONdata.features.filter(function(feature) {
        return feature.properties.TAXA.toLowerCase().includes(taxaToHighlight.toLowerCase());
      });

      if(lastLayerAdded) {
        map.removeLayer(lastLayerAdded);
      }
      lastLayerAdded = L.geoJSON(filteredData, {
        pointToLayer: function(feature, latlng) {
          return L.circleMarker(latlng, treeMarkerHighlightedOptions);
        },
        onEachFeature: onEachTree
      }).addTo(map);
    }

    function resetHighlight() {
      if(lastLayerAdded) {
        map.removeLayer(lastLayerAdded);
      }
      lastLayerAdded = L.geoJSON(treeGeoJSONdata, {
        pointToLayer: treePointToLayer,
        onEachFeature: onEachTree
      }).addTo(map);
    }

    $(document).ready(function() {
      $.getJSON("https://raw.githubusercontent.com/UBCGeodata/ubc-geospatial-opendata/master/ubcv/landscape/geojson/ubcv_campus_trees.geojson", function(data) {
        treeGeoJSONdata = data;
        addTrees();
      });

      $('#showAllTreesButton').click(addTrees);
      $('#highlightTreesButton').click(function() {
        var taxa = $('#highlightTreesTextEntry').val();
        highlightTrees(taxa);
      });
      $('#resetHighlightButton').click(resetHighlight);
    });
  </script>
</body>
</html>
